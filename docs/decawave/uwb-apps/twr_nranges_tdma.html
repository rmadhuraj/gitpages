

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    

    
    <title>twr_nranges_tdma &mdash; Apache Mynewt latest documentation</title>
    

    
    
      <link rel="shortcut icon" href="../../_static/mynewt-logo-only-newt32x32.png"/>
    

    

    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

    
      <link rel="stylesheet" href="../../_static/css/sphinx_theme.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/bootstrap-3.0.3.min.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/v2.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/custom.css" type="text/css" />
    
      <link rel="stylesheet" href="../../_static/css/restructuredtext.css" type="text/css" />
    

    

    <link rel="stylesheet" href="../../_static/css/overrides.css" type="text/css" />
          <link rel="index" title="Index"
                href="../../genindex.html"/>
          <link rel="search" title="Search" href="../../search.html"/>
      <link rel="top" title="Apache Mynewt latest documentation" href="../../index.html"/>
          <link rel="up" title="UWB-APPS" href="uwb-apps.html"/>
          <link rel="next" title="lwip_ping" href="lwip_ping.html"/>
          <link rel="prev" title="twr_tdma" href="twr_tdma.html"/> 

    
    <script src="../../_static/js/modernizr.min.js"></script>

    
    <script>
    (function(i, s, o, g, r, a, m) {
	i["GoogleAnalyticsObject"] = r;
	(i[r] =
		i[r] ||
		function() {
			(i[r].q = i[r].q || []).push(arguments);
		}),
		(i[r].l = 1 * new Date());
	(a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
	a.async = 1;
	a.src = g;
	m.parentNode.insertBefore(a, m);
})(window, document, "script", "//www.google-analytics.com/analytics.js", "ga");

ga("create", "UA-72162311-1", "auto");
ga("send", "pageview");
</script>
    

  </head>

  <body class="not-front page-documentation" role="document" >
    <div id="wrapper">
      <div class="container">
    <div id="banner" class="row v2-main-banner">
        <a class="logo-cell" href="/">
            <img class="logo" src="../../_static/img/logo.png">
        </a>
        <div class="tagline-cell">
            <h4 class="tagline">An OS to build, deploy and securely manage billions of devices</h4>
        </div>
        <div class="news-cell">
            <div class="well">
                <h4>Latest News:</h4> <a href="/download">Apache Mynewt 1.7.0, Apache NimBLE 1.2.0 </a> released (August 4, 2019)
            </div>
        </div>
    </div>
</div>
      
<header>
    <nav id="navbar" class="navbar navbar-inverse" role="navigation">
        <div class="container">
            <!-- Collapsed navigation -->
            <div class="navbar-header">
                <!-- Expander button -->
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

            </div>

            <!-- Expanded navigation -->
            <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/"><i class="fa fa-home" style="font-size: larger;"></i></a>
                    </li>
                    <li class="important">
                        <a href="/quick-start/">Quick Start</a>
                    </li>
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    <li>
                        <a href="/talks/">Talks</a>
                    </li>
                    <li class="active">
                        <a href="/documentation/">Documentation</a>
                    </li>
                    <li>
                        <a href="/download/">Download</a>
                    </li>
                    <li>
                        <a href="/community/">Community</a>
                    </li>
                    <li>
                        <a href="/events/">Events</a>
                    </li>
                </ul>

                <!-- Search, Navigation and Repo links -->
                <ul class="nav navbar-nav navbar-right">
                    
                </ul>
            </div>
        </div>
    </nav>
</header>
      <!-- STARTS MAIN CONTENT -->
      <div id="main-content">
        





<div id="breadcrumb">
  <div class="container">
    <a href="/documentation/">Docs</a> /
    
      <a href="../decawave.html">Decawave-UWB User Guide</a> /
    
      <a href="uwb-apps.html">UWB-APPS</a> /
    
    twr_nranges_tdma
    
  <div class="sourcelink">
    <a href="https://github.com/apache/mynewt-documentation/edit/master/docs/decawave/uwb-apps/twr_nranges_tdma.rst" class="icon icon-github"
           rel="nofollow"> Edit on GitHub</a>
</div>
  </div>
</div>
        <!-- STARTS CONTAINER -->
        <div class="container">
          <!-- STARTS .content -->
          <div id="content" class="row">
            
            <!-- STARTS .container-sidebar -->
<div class="container-sidebar col-xs-12 col-sm-3">
  <div id="docSidebar" class="sticky-container">
    <div role="search" class="sphinx-search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search documentation" class="search-documentation" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
    <!-- Note: only works when deployed -->
<select class="form-control" onchange="if (this.value) window.location.href=this.value">
  <option value="/latest" selected>
    Version: latest
  </option>
  <option value="/v1_7_0" >
    Version: 1.7.0
  </option>
  <option value="/v1_6_0" >
    Version: 1.6.0
  </option>
  <option value="/v1_5_0" >
    Version: 1.5.0
  </option>
  <option value="/v1_4_0" >
    Version: 1.4.0
  </option>
  <option value="/v1_3_0/os/introduction" >
    Version: 1.3.0
  </option>
  <option value="/v1_2_0/os/introduction" >
    Version: 1.2.0
  </option>
  <option value="/v1_1_0/os/introduction" >
    Version: 1.1.0
  </option>
  <option value="/v1_0_0/os/introduction" >
    Version: 1.0.0
  </option>
  <option value="/v0_9_0/os/introduction" >
    Version: 0.9.0
  </option>
</select>
    <div class="region region-sidebar">
      <div class="docs-menu">
      
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../get_started/index.html">Setup &amp; Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../external_links.html">Third-party Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../os/os_user_guide.html">OS User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/docs/index.html">BLE User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../decawave.html">Decawave-UWB User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../uwb-core/uwb-core.html">uwb-core</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="uwb-apps.html">uwb-apps</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="twr_aloha.html">twr_aloha</a></li>
<li class="toctree-l3"><a class="reference internal" href="twr_tdma.html">twr_tdma</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">twr_nranges_tdma</a></li>
<li class="toctree-l3"><a class="reference internal" href="lwip_ping.html">lwip_ping</a></li>
<li class="toctree-l3"><a class="reference internal" href="ota_over_uwb.html">ota_over_uwb</a></li>
<li class="toctree-l3"><a class="reference internal" href="rtdoa.html">rtdoa</a></li>
<li class="toctree-l3"><a class="reference internal" href="openthread.html">openthread</a></li>
<li class="toctree-l3"><a class="reference internal" href="listener.html">listener</a></li>
<li class="toctree-l3"><a class="reference internal" href="loopback.html">loopback</a></li>
<li class="toctree-l3"><a class="reference internal" href="matlab.html">matlab</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../newt/index.html">Newt Tool Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../newtmgr/index.html">Newt Manager Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mynewt_faq/index.html">Mynewt FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/index.html">Appendix</a></li>
</ul>

        
      
      </div>
    </div>
  </div>
  <!-- ENDS STICKY CONTAINER -->
</div>
<!-- ENDS .container-sidebar -->

            <div class="col-xs-12 col-sm-9">
              

              
              <div class="">
                <div class="rst-content">
                  <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                   <div itemprop="articleBody">
                    
  <div class="section" id="twr-nranges-tdma">
<h1>twr_nranges_tdma<a class="headerlink" href="#twr-nranges-tdma" title="Permalink to this headline">¶</a></h1>
<div class="section" id="ranging-with-n-nodes-using-n-2-messages-along-with-tdma-slotting">
<h2>Ranging with n nodes using n+2 messages along with TDMA slotting.<a class="headerlink" href="#ranging-with-n-nodes-using-n-2-messages-along-with-tdma-slotting" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This example demonstrates the nrng use case–n ranges measurements with n+2 frames. Here we use the CCP/TDMA to create a synchronous network with a superframe period of 1s and 160 TDMA slots. A tag[s] performs a range request[s] at the beginning of each TDMA slot. The nodes listen for a range request at the beginning [first 200us] of each TDMA slot. A tag can range to 1 to 16 nodes within a single TDMA slot. Each node responses sequential to the request based on their allocated node-slot–Note there are two slot mechanisms at work here; TDMA-slots and a node-slots. The node-slots are spaced approximately 270us apart within the TDMA slot with 16 nodes occupying about 4500us of the available 6300us windows. Practically a tag will range to a subset of available nodes or practically only a subset of the available nodes will be within range of the tag.</p>
<p>The example also illustrates the WCS (Wireless Clock Synchronization) capability, here the TOA (Time Of Arrival) timestamps are reported in master clock (node0) reference frame.</p>
</div>
<div class="section" id="building-target-for-up-to-8-nodes">
<h2>Building target for (up to) 8 nodes<a class="headerlink" href="#building-target-for-up-to-8-nodes" title="Permalink to this headline">¶</a></h2>
<p>Master node (only one allowed per network):</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">newt target create nrng_master_node</span>
<span class="go">newt target set nrng_master_node app=apps/twr_nranges_tdma</span>
<span class="go">newt target set nrng_master_node bsp=@decawave-uwb-core/hw/bsp/dwm1001</span>
<span class="go">newt target set nrng_master_node build_profile=debug</span>
<span class="go">newt target amend nrng_master_node syscfg=PANMASTER_ISSUER=1</span>
<span class="go">newt run nrng_master_node 0.1.0</span>
</pre></div>
</div>
<p>Slave nodes</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">newt target create nrng_slave_node</span>
<span class="go">newt target set nrng_slave_node app=apps/twr_nranges_tdma</span>
<span class="go">newt target set nrng_slave_node bsp=@decawave-uwb-core/hw/bsp/dwm1001</span>
<span class="go">newt target set nrng_slave_node build_profile=debug</span>
<span class="go">newt target amend nrng_slave_node syscfg=NRANGES_ANCHOR=1</span>
<span class="go">newt run nrng_slave_node 0.1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="building-target-for-tags">
<h2>Building target for tags<a class="headerlink" href="#building-target-for-tags" title="Permalink to this headline">¶</a></h2>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">newt target create nrng_tag</span>
<span class="go">newt target set nrng_tag app=apps/twr_nranges_tdma</span>
<span class="go">newt target set nrng_tag bsp=@decawave-uwb-core/hw/bsp/dwm1001</span>
<span class="go">newt target set nrng_tag build_profile=debug</span>
<span class="go">newt target amend nrng_tag syscfg=NRNG_NTAGS=4:NRNG_NNODES=8:NRNG_NFRAMES=16:NODE_START_SLOT_ID=0:NODE_END_SLOT_ID=7</span>
<span class="gp">#</span>newt target amend nrng_tag <span class="nv">syscfg</span><span class="o">=</span><span class="nv">DW1000_SYS_STATUS_BACKTRACE_LEN</span><span class="o">=</span><span class="m">128</span>
<span class="go">newt run nrng_tag 0.1.0</span>
</pre></div>
</div>
<p><strong>NOTE:</strong> The value of NRNG_FRAMES must be atleast NRNG_NODES*2.</p>
</div>
<div class="section" id="nrng-profile-fom">
<h2>NRNG profile FOM:<a class="headerlink" href="#nrng-profile-fom" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>+---------+------------------------------------+----------------+
| profile | Description                        | Benchmark      |
+=========+====================================+================+
| nrng_ss | n TWR_SS ranges with n+2 messages. | 2225us for n=4 |
+---------+------------------------------------+----------------+
</pre></div>
</div>
<p>FOM = frame duration + TX_HOLDOFF + n * (frame duration + TX_GUARD_DELAY)</p>
<dl class="docutils">
<dt>The number of nodes to range with can be configured by setting the <strong>NRNG_NNODES</strong> on tag app during build time,</dt>
<dd>(ex: for 3 nodes, use this command while building tag app <strong>newt target amend tag syscfg=NRNG_NNODES=3</strong> )</dd>
</dl>
<p>To monitor the logs from the multiple tags in same PC, issue the following command to modify the nrng_tag target:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">newt target amend nrng_tag syscfg=CONSOLE_RTT=0:CONSOLE_UART=1</span>
</pre></div>
</div>
<p>Rebuild the app and run again.
Use Any serial Console app with 1000000 baudrate on PC to monitor the Logs.</p>
</div>
<div class="section" id="expected-tag-output">
<h2>Expected Tag Output<a class="headerlink" href="#expected-tag-output" title="Permalink to this headline">¶</a></h2>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">{&quot;utime&quot;: 88255157,&quot;wcs&quot;: [23983557962832,893813779536,5637890867503,893813779536],&quot;skew&quot;: 13742592839501479936}</span>
<span class="go">{&quot;utime&quot;: 88307220,&quot;nrng&quot;: {&quot;seq&quot;: 224,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.088&quot;,&quot;8.039&quot;,&quot;1.320&quot;,&quot;8.426&quot;,&quot;7.131&quot;,&quot;6.604&quot;,&quot;7.026&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">{&quot;utime&quot;: 88334106,&quot;nrng&quot;: {&quot;seq&quot;: 225,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.065&quot;,&quot;8.067&quot;,&quot;1.329&quot;,&quot;8.421&quot;,&quot;7.122&quot;,&quot;6.636&quot;,&quot;7.026&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">{&quot;utime&quot;: 88361022,&quot;nrng&quot;: {&quot;seq&quot;: 226,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.076&quot;,&quot;8.093&quot;,&quot;1.322&quot;,&quot;8.541&quot;,&quot;7.108&quot;,&quot;6.585&quot;,&quot;6.444&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">{&quot;utime&quot;: 88414794,&quot;nrng&quot;: {&quot;seq&quot;: 228,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.041&quot;,&quot;8.065&quot;,&quot;1.317&quot;,&quot;8.468&quot;,&quot;7.101&quot;,&quot;6.599&quot;,&quot;6.453&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">{&quot;utime&quot;: 88387908,&quot;nrng&quot;: {&quot;seq&quot;: 227,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.088&quot;,&quot;8.074&quot;,&quot;1.231&quot;,&quot;8.635&quot;,&quot;7.110&quot;,&quot;6.592&quot;,&quot;6.439&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">{&quot;utime&quot;: 88468566,&quot;nrng&quot;: {&quot;seq&quot;: 230,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.090&quot;,&quot;8.039&quot;,&quot;1.249&quot;,&quot;8.529&quot;,&quot;7.103&quot;,&quot;6.634&quot;,&quot;7.044&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">{&quot;utime&quot;: 88441680,&quot;nrng&quot;: {&quot;seq&quot;: 229,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.079&quot;,&quot;8.004&quot;,&quot;1.294&quot;,&quot;8.738&quot;,&quot;7.138&quot;,&quot;6.592&quot;,&quot;6.451&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">{&quot;utime&quot;: 88495452,&quot;nrng&quot;: {&quot;seq&quot;: 231,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.046&quot;,&quot;8.088&quot;,&quot;1.301&quot;,&quot;8.623&quot;,&quot;7.115&quot;,&quot;6.578&quot;,&quot;6.472&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">{&quot;utime&quot;: 88522338,&quot;nrng&quot;: {&quot;seq&quot;: 232,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.060&quot;,&quot;8.114&quot;,&quot;1.264&quot;,&quot;8.419&quot;,&quot;7.115&quot;,&quot;6.629&quot;,&quot;5.968&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">{&quot;utime&quot;: 88549224,&quot;nrng&quot;: {&quot;seq&quot;: 233,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.088&quot;,&quot;8.100&quot;,&quot;1.299&quot;,&quot;8.731&quot;,&quot;7.112&quot;,&quot;6.599&quot;,&quot;6.517&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">{&quot;utime&quot;: 88576110,&quot;nrng&quot;: {&quot;seq&quot;: 234,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.036&quot;,&quot;8.100&quot;,&quot;1.303&quot;,&quot;8.742&quot;,&quot;7.112&quot;,&quot;6.618&quot;,&quot;7.073&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">{&quot;utime&quot;: 88603027,&quot;nrng&quot;: {&quot;seq&quot;: 235,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.086&quot;,&quot;8.046&quot;,&quot;1.200&quot;,&quot;8.618&quot;,&quot;7.122&quot;,&quot;6.620&quot;,&quot;7.056&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">{&quot;utime&quot;: 88629882,&quot;nrng&quot;: {&quot;seq&quot;: 236,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.053&quot;,&quot;8.112&quot;,&quot;1.320&quot;,&quot;8.613&quot;,&quot;7.143&quot;,&quot;6.594&quot;,&quot;6.529&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">{&quot;utime&quot;: 88656799,&quot;nrng&quot;: {&quot;seq&quot;: 237,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.060&quot;,&quot;8.097&quot;,&quot;1.320&quot;,&quot;8.412&quot;,&quot;7.098&quot;,&quot;6.650&quot;,&quot;7.026&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">{&quot;utime&quot;: 88683654,&quot;nrng&quot;: {&quot;seq&quot;: 238,&quot;mask&quot;: 127,&quot;rng&quot;: [&quot;8.051&quot;,&quot;8.083&quot;,&quot;1.278&quot;,&quot;8.423&quot;,&quot;7.117&quot;,&quot;6.648&quot;,&quot;6.456&quot;],&quot;uid&quot;: [&quot;1946&quot;,&quot;5199&quot;,&quot;5235&quot;,&quot;2293&quot;,&quot;1436&quot;,&quot;5936&quot;,&quot;3958&quot;]}}</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
<div class="section" id="expected-tag-interrupt-backtrace-output">
<h2>Expected Tag Interrupt backtrace Output<a class="headerlink" href="#expected-tag-interrupt-backtrace-output" title="Permalink to this headline">¶</a></h2>
<p>By uncommenting the line:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">newt target amend nrng_tag syscfg=DW1000_SYS_STATUS_BACKTRACE_LEN=128</span>
</pre></div>
</div>
<p>You can view the timing for the interrupts and see the occurrence of Tx and Rx frames. In this case, we see four nodes responding to the Tag’s nrng request.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">   dw1000 ibt</span>

<span class="go">       usec   diff usec    abs usec  fctrl   status    status2txt</span>
<span class="go">--------------------------------------------------------------------------------</span>
<span class="go">          0           0    51983227  41 88  000000E1  TxFrameSent|TxPHYDone|TxPreamDone|IRS</span>
<span class="go">        794         794    51984021  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">       1271         477    51984498  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">       1748         477    51984975  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">       2225         477    51985452  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">       4874        2649    51988101         00020001  RxTimeout|IRS</span>
<span class="go">      26703       21829    52009930         00000011  TxStart|IRS</span>
<span class="go">      26891         188    52010118  41 88  000000E1  TxFrameSent|TxPHYDone|TxPreamDone|IRS</span>
<span class="go">      27684         793    52010911  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">      28161         477    52011388  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">      28638         477    52011865  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">      29115         477    52012342  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">      31781        2666    52015008         00020001  RxTimeout|IRS</span>
<span class="go">      53590       21809    52036817         00000011  TxStart|IRS</span>
<span class="go">      53777         187    52037004  41 88  000000E1  TxFrameSent|TxPHYDone|TxPreamDone|IRS</span>
<span class="go">      54571         794    52037798  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">      55048         477    52038275  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">      55525         477    52038752  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">      56002         477    52039229  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">      58659        2657    52041886         00020001  RxTimeout|IRS</span>
<span class="go">      80476       21817    52063703         00000011  TxStart|IRS</span>
<span class="go">      80664         188    52063891  41 88  000000E1  TxFrameSent|TxPHYDone|TxPreamDone|IRS</span>
<span class="go">      81458         794    52064685  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">      81935         477    52065162  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">      82412         477    52065639  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">      82889         477    52066116  41 88  00006F01  RxFCSGood|RxDataFrmRdy|RxPHYDet|RxLDEdone|RxSFDet|RxPreamDet|IRS</span>
<span class="go">      85553        2664    52068780         00020001  RxTimeout|IRS</span>
<span class="go">     107370       21817    52090597         00000011  TxStart|IRS</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
<div class="section" id="node-specific-commands">
<h2>Node specific commands<a class="headerlink" href="#node-specific-commands" title="Permalink to this headline">¶</a></h2>
<p>The node firmware can act both as slave_node and master_node by changing the config parameters
in runtime. To view the configuration parameters avaiable use the <code class="docutils literal notranslate"><span class="pre">config</span> <span class="pre">dump</span></code> command
in the console connected to the RTT (<code class="docutils literal notranslate"><span class="pre">nc</span> <span class="pre">localhost</span> <span class="pre">19021</span></code>) or UART of the board.</p>
<p>To promote a slave_node to master_node use the following commands:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">config uwb/role 0x7</span>
<span class="go">config save</span>
<span class="go">reset</span>
</pre></div>
</div>
<p>To demote a master_node to slave_node use the following commands:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">config uwb/role 0x4</span>
<span class="go">config save</span>
<span class="go">reset</span>
</pre></div>
</div>
<p><strong>NOTE</strong> Changing the uwb/role to 0x0 makes that board act as a tag.</p>
</div>
<div class="section" id="broadcast-of-firmware-from-one-node-to-all-others">
<h2>Broadcast of firmware from one node to all others<a class="headerlink" href="#broadcast-of-firmware-from-one-node-to-all-others" title="Permalink to this headline">¶</a></h2>
<p>When working with a network of nodes it can be useful to update them all at once.
In this example we will distribute version 0.1.2 to a network of nodes having the version
0.1.1. First, program one node with the new firmware, it doesn’t have to be the master:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">newt run slave_node 0.1.2</span>
</pre></div>
</div>
<p>Before proceeding, make sure no tags are active as the tag-slot is shared with the
uwb_nmgr layer carrying the firmware update.
Then, connected to the console of the recently programmed node run:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bota txim 0xffff 0</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">bota</span></code> is the command to Broadcast Over The Air updates, <code class="docutils literal notranslate"><span class="pre">txim</span></code> is transmit
image, 0xffff is the broadcast address (all nodes), and 0 is the image we’d like to send.
Instead of tranmitting image 0 (the current running) you can also transmit image 1.</p>
<p>This command will use the tag slots to send data over uwb to all other nodes. When the
transfere is complete the receiving node will check that the checksum is correct and if so
boot into the new image. If not, it will not do anything. If there are any errors during the
transfere this will result in a failed checksum, but the command can be run and the image
transmitted several times. The receiving node fills in it’s image with the parts it
successfully receives until it succeeds or no further transmissions are done.</p>
<p>In short, if the command doesn’t succeed in updating all nodes at first, try again.
Note that the command runs for about a minute and you should let it finish before starting
again.</p>
<p>To check if all nodes are on the same firmware use the <code class="docutils literal notranslate"><span class="pre">panm</span> <span class="pre">list</span></code> command on the master
node. This will show the active firmware on all nodes in the network. Example below:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">441467 compat&gt; panm list</span>
<span class="go">441494 #idx, addr, role, slot, p,  lease, euid,             flags,          date-added, fw-ver</span>
<span class="go">441494    0,  bad,    1,    0,  ,       , 010B1044C2230BAD,  1000, 1970-01-01T00:00:00, 0.0.4</span>
<span class="go">441494    1,  ca8,    1,    1,  , 3597.8, 010B1044C2230CA8,  1000, 1970-01-01T00:00:05, 0.0.4</span>
<span class="go">441495    2, 9211,    2,    0,  , 3597.8, 05A2610048E19211,  2000, 1970-01-01T00:00:58, 0.0.4</span>
<span class="go">...</span>
</pre></div>
</div>
<p>where role 1=anchor and 2=tag.</p>
</div>
<div class="section" id="for-pdoa-on-dwm1002-module">
<h2>6. For PDOA on DWM1002 module.<a class="headerlink" href="#for-pdoa-on-dwm1002-module" title="Permalink to this headline">¶</a></h2>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">newt target create dwm1002_nrng_slave_node</span>
<span class="go">newt target set dwm1002_nrng_slave_node app=apps/twr_nranges_tdma</span>
<span class="go">newt target set dwm1002_nrng_slave_node bsp=@decawave-uwb-core/hw/bsp/dwm1002</span>
<span class="go">newt target set dwm1002_nrng_slave_node build_profile=debug</span>
<span class="go">newt target amend dwm1002_nrng_slave_node syscfg=DW1000_DEVICE_0=1:DW1000_DEVICE_1=1:USE_DBLBUFFER=0:CIR_ENABLED=1</span>
<span class="go">newt target amend dwm1002_nrng_slave_node syscfg=NRANGES_ANCHOR=1</span>
<span class="gp">#</span>newt target amend dwm1002_nrng_slave_node <span class="nv">syscfg</span><span class="o">=</span><span class="nv">CONSOLE_RTT</span><span class="o">=</span><span class="m">0</span>:CONSOLE_UART<span class="o">=</span><span class="m">1</span>
<span class="go">newt run dwm1002_nrng_slave_node 0</span>
</pre></div>
</div>
</div>
</div>


                   </div>
                  </div>
                  
    <div class="rst-footer-buttons row" role="navigation" aria-label="footer navigation">
      
        <a href="lwip_ping.html" class="btn btn-neutral float-right" title="lwip_ping" accesskey="n">Next: lwip_ping <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="twr_tdma.html" class="btn btn-neutral" title="twr_tdma" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous: twr_tdma</a>
      
    </div>

                </div>
              </div>
            </div>
            <!-- ENDS CONTENT SECTION -->
          </div>
          <!-- ENDS .content -->
        </div>
      </div>
      <footer>
  <div class="container">
    <div class="row">
      <div class="col-xs-12">
          
              <p class="copyright">Apache Mynewt is available under Apache License, version 2.0.</p>
          
      </div>
      <div class="col-xs-12">
          <div class="logos">
              <img src="../../_static/img/asf_logo_wide_small.png" alt="Apache" title="Apache">
              <small class="footnote">
                Apache Mynewt, Mynewt, Apache, the Apache feather logo, and the Apache Mynewt project logo are either
                registered trademarks or trademarks of the Apache Software Foundation in the United States and other countries.
              </small>
              <a href="">
                <img src="../../_static/img/add_to_slack.png" alt="Slack Icon" title="Join our Slack Community" />
              </a>
          </div>
      </div>
    </div>
  </div>
</footer>
    </div>
    <!-- ENDS #wrapper -->

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'latest',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>
      <script type="text/javascript" src="../../_static/js/bootstrap-3.0.3.min.js"></script>
      <script type="text/javascript" src="../../_static/js/affix.js"></script>
      <script type="text/javascript" src="../../_static/js/main.js"></script>

   

  </body>
</html>